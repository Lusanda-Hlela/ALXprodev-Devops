#!/bin/bash

# Output directory
mkdir -p pokemon_data
ERROR_LOG="errors.txt"

# List of Pokémon
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

for pokemon in "${POKEMONS[@]}"
do
    echo "Fetching data for $pokemon..."
    URL="https://pokeapi.co/api/v2/pokemon/$pokemon"
    OUT_FILE="pokemon_data/${pokemon}.json"

    success=false
    retries=0
    max_retries=3

    while [ "$success" = false ] && [ $retries -lt $max_retries ]; do
        curl -s -f "$URL" -o "$OUT_FILE"
        if [ $? -eq 0 ]; then
            echo "Saved data to $OUT_FILE ✅"
            success=true
        else
            ((retries++))
            echo "Retry $retries for $pokemon..."
            sleep 1
        fi
    done

    if [ "$success" = false ]; then
        echo "Failed to fetch data for $pokemon after $max_retries attempts ❌" | tee -a "$ERROR_LOG"
    fi

    # Always wait before next Pokémon
    sleep 1
done
